@using Blog.Models
@using Microsoft.AspNet.Identity
@model BlogPost

@{
    ViewBag.Title = "Details";
}

<section class="blog-post-area section-margin">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <div class="main_blog_details">
                    @if (Model.MediaURL != null)
                    {
                        <img class="img-fluid" src="@Model.MediaURL" alt="">
                    }
                    else
                    {
                        <img class="img-fluid" src="~/Images/IMG_0693.JPG" alt="">
                    }
                    <a href="#"><h4>@Model.Title<br /> <!--subtitle--></h4></a>
                    <div class="user_details">
                        @*<div class="float-left">
                            <a href="#">Lifestyle</a>
                            <a href="#">Gadget</a>
                        </div>*@
                        <div class="float-right mt-sm-0 mt-3">
                            <div class="media">
                                <div class="media-body">
                                    <h5>@Model.Author.FirstName @Model.Author.LastName</h5>
                                    <p>@Model.Created</p>
                                </div>
                                <div class="d-flex">
                                    <a href="@Url.Action("Index", "Account", new { Id = Model.AuthorId })"><img width="42" height="42" src=@Model.Author.AvatarPath alt=""></a>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                    <p>@Html.Raw(Model.BlogPostBody)</p>
                    <div class="news_d_footer flex-column flex-sm-row">
                        @*<a href="#"><span class="align-middle mr-2"><i class="ti-heart"></i></span>4 people like this</a>*@
                        <a class="justify-content-sm-center ml-sm-auto mt-sm-0 mt-2" href="#"><span class="align-middle mr-2"><i class="ti-themify-favicon"></i></span>@Model.Comments.Count Comments</a>
                        @*<div class="news_socail ml-sm-auto mt-sm-0 mt-2">
                            <a href="#"><i class="fab fa-facebook-f"></i></a>
                            <a href="#"><i class="fab fa-twitter"></i></a>
                            <a href="#"><i class="fab fa-dribbble"></i></a>
                            <a href="#"><i class="fab fa-behance"></i></a>
                        </div>*@
                    </div>
                </div>


                <div class="comments-area">
                    <h4>@Model.Comments.Count Comments</h4>

                    <div class="comment-list">
                    @foreach (var comment in Model.Comments.OrderByDescending(c => c.Created))
                    {
                        if (comment.Author != null)
                        {
                        <div class="single-comment justify-content-between d-flex">
                            <div class="user justify-content-between d-flex">
                                <div class="thumb">
                                    <img src="img/blog/c1.jpg" alt="">
                                </div>
                                <div class="desc">
                                    <h5><a href="@Url.Action("Index", "Account", new { Id = comment.AuthorId})">@comment.Author.DisplayName</a></h5>
                                    <p class="date">@comment.Created.ToString("MM/dd/yyyy hh:mm tt")</p>
                                    <p class="comment">
                                        @comment.CommentBody
                                    </p>

                                </div>

                            </div>

                            @if (comment.AuthorId == User.Identity.GetUserId() || User.IsInRole("Admin") || User.IsInRole("Moderator"))
                            {
                            <div class="reply-btn">
                                <a href="@Url.Action("Edit", "Comments", new { Id = comment.Id})" class="btn-reply text-uppercase">Edit</a>
                                <a href="@Url.Action("Delete", "Comments", new { Id = comment.Id})" class="btn-reply text-uppercase">Delete</a>
                            </div>
                                    @*<a class=" fa-pull-right" href="@Url.Action("Edit", "Comments", new { Id = comment.Id})">Edit Comment <i></i></a>*@
                            }

                        </div>
                        }
                    }

                    </div>
                </div>

                <div class="comment-form">
                    @if (User.Identity.IsAuthenticated)
                    {
                        <h4>Leave a Reply</h4>
                    }
                    else
                    {
                        <h4>Login to reply.</h4>
                    }

                    @using (Html.BeginForm("Create", "Comments", FormMethod.Post))
                    {
                        @Html.AntiForgeryToken()
                        @Html.Hidden("BlogPostId", Model.Id)
                        if (User.Identity.IsAuthenticated)
                        {
                            <div class="form-group-reply">
                                @Html.TextArea("commentBody", new
                                    {
                                       @class = "form-control mb-10",
                                       @rows = "5",
                                       @name = "message",
                                       @placeholder = "MESSAGE",
                                       @onfocus = "this.placeholder = ''",
                                       @onblur = "this.placeholder = 'MESSAGE'",
                                       @required = "",
                                       @style = "text-transform: none"
                                    })
                            </div>
                            <div class="form-group">
                                <input type="submit" value="Post Comment" class="button submit_btn" />
                            </div>
                        }
                        else
                        {
                            <div class="form-group">
                                <a class="button submit_btn" href=@Url.Action("Login", "Account")>Login</a>
                            </div>
                        }

                    }
                    @*<form>
                            <div class="form-group">
                                <textarea class="form-control mb-10" rows="5" name="message" placeholder="Messege" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Messege'" required=""></textarea>
                            </div>
                            <a href="#" class="button submit_btn">Post Comment</a>
                        </form>*@
                </div>
            </div>

            <!-- Start Blog Post Siddebar -->
            <div class="col-lg-4 sidebar-widgets">
                <div class="widget-wrap">
                    <div class="single-sidebar-widget newsletter-widget">
                        <h4 class="single-sidebar-widget__title">Newsletter</h4>
                        <div class="form-group mt-30">
                            <div class="col-autos">
                                <input type="text" class="form-control" id="inlineFormInputGroup" placeholder="Enter email" onfocus="this.placeholder = ''"
                                       onblur="this.placeholder = 'Enter email'">
                            </div>
                        </div>
                        <button class="bbtns d-block mt-20 w-100">Subcribe</button>
                    </div>


                    <div class="single-sidebar-widget post-category-widget">
                        <h4 class="single-sidebar-widget__title">Catgory</h4>
                        <ul class="cat-list mt-20">
                            <li>
                                <a href="#" class="d-flex justify-content-between">
                                    <p>Technology</p>
                                    <p>(03)</p>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="d-flex justify-content-between">
                                    <p>Software</p>
                                    <p>(09)</p>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="d-flex justify-content-between">
                                    <p>Lifestyle</p>
                                    <p>(12)</p>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="d-flex justify-content-between">
                                    <p>Shopping</p>
                                    <p>(02)</p>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="d-flex justify-content-between">
                                    <p>Food</p>
                                    <p>(10)</p>
                                </a>
                            </li>
                        </ul>
                    </div>

                </div>
            </div>
        </div>
        <!-- End Blog Post Siddebar -->
    </div>
</section>

@section scripts{
    <script src="~/Scripts/tinymce/tinymce.min.js"></script>
    <script src="~/Scripts/tinymce/jquery.tinymce.min.js"></script>
    <script type="text/javascript">
        $(function () {
            tinymce.init({
                selector: '#editor'
            });
        });
    </script>
}
